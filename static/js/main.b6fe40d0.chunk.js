(this["webpackJsonponeroute-widget"]=this["webpackJsonponeroute-widget"]||[]).push([[0],{45:function(e,t,a){e.exports=a(82)},81:function(e,t,a){},82:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(43),s=a.n(r),l=a(17),c=a(21),i=a(7),u=a(2),d=a.n(u),v=a(8),m=a(1),g=a(44),p=function(e){var t=e.response;return!t||401!==t.data.code&&401!==t.status?t&&t.data.errors&&t.data.errors[0]?t.data.errors[0].message:t&&t.data.message?t.data.message:t&&t.data.error?t.data.error:"There might be a problem with your internet connection. Please check and try again.":""};a(29),a(81);var f=function(e){var t,a,r,s,u,f,b=null===e||void 0===e?void 0:e.widgetid,h=Object(n.useState)(!1),E=Object(m.a)(h,2),w=E[0],j=E[1],O=Object(n.useState)(!1),N=Object(m.a)(O,2),x=N[0],k=N[1],y=Object(n.useState)(!0),_=Object(m.a)(y,2),S=_[0],C=_[1],z=Object(n.useState)(!1),I=Object(m.a)(z,2),F=I[0],T=I[1],U=Object(n.useState)(!0),A=Object(m.a)(U,2),P=A[0],R=A[1],D=Object(n.useState)({}),L=Object(m.a)(D,2),M=L[0],q=L[1],J=Object(n.useState)({}),H=Object(m.a)(J,2),Y=H[0],B=H[1],G=Object(n.useState)({}),V=Object(m.a)(G,2),K=V[0],Q=V[1],W=Object(n.useState)(!1),X=Object(m.a)(W,2),Z=X[0],$=X[1],ee=Object(n.useState)(!1),te=Object(m.a)(ee,2),ae=te[0],ne=te[1],oe=Object(n.useState)(!1),re=Object(m.a)(oe,2),se=re[0],le=re[1],ce=Object(n.useState)(null),ie=Object(m.a)(ce,2),ue=ie[0],de=ie[1],ve=Object(n.useState)(!1),me=Object(m.a)(ve,2),ge=me[0],pe=me[1],fe=Object(n.useState)(null),be=Object(m.a)(fe,2),he=be[0],Ee=be[1],we=Y||{},je=we.color,Oe=we.logo,Ne=we.headText,xe=we.subText,ke=we.toolTip,ye=we.channels,_e="https://api.staging.oneroute.io/",Se=null===ye||void 0===ye?void 0:ye.find((function(e){var t;return"livechat"===(null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.toLowerCase())})),Ce=Object(n.useRef)(localStorage.getItem("conversationId")||null),ze=Object(n.useRef)(!1),Ie=Object(n.useRef)([]),Fe=Object(n.useRef)(),Te=function(){var e=Object(v.a)(d.a.mark((function e(){var t,a,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(_e,"api/widget/").concat(b));case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,!0===(null===a||void 0===a?void 0:a.success)&&B(null===a||void 0===a?void 0:a.data),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),n=p(e.t0),Ee(n);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){var e;Te(),(null===(e=window.location.href)||void 0===e?void 0:e.includes("/feedback"))||j(!0),Ce.current&&(R(!1),Me())}),[]),Object(n.useEffect)((function(){var e=Object(g.io)(_e,{reconnectionDelay:1e3,reconnection:!0,transports:["websocket"]}),t=document.querySelector(".oneroute_widget");e.on("newMessage",(function(e){var a,n,o;(null===e||void 0===e||null===(a=e.conversation)||void 0===a?void 0:a.id)===localStorage.getItem("conversationId")&&!1!==(null===e||void 0===e||null===(n=e.message)||void 0===n||null===(o=n.sender)||void 0===o?void 0:o.authUser)&&t.setAttribute("data-newmessage","true")}))}),[]);var Ue=document.querySelector(".oneroute_widget");Object(n.useEffect)((function(){var e=setInterval((function(){"true"===Ue.getAttribute("data-newmessage")&&qe(!1,!0)}),1e3);return function(){return clearInterval(e)}}),[]),Object(n.useEffect)((function(){x||C(!0)}),[x]),Object(n.useEffect)((function(){var e,t=null===(e=document)||void 0===e?void 0:e.querySelector(".chat_messages");if(F&&t){t.addEventListener("scroll",Je),pe(!0);var a=setInterval((function(){pe(!1),clearInterval(a)}),1e3)}}),[F]);var Ae=function(e){switch(e.toLowerCase()){case"livechat":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/oneroute.svg";case"email":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/email.svg";case"instagram":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/instagram.svg";case"facebook":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/facebook.svg";case"oneroute":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/oneroute.svg";case"sms":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/sms.svg";case"twitter":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/twitter.svg";case"whatsapp":return"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/whatsapp.svg";default:return}},Pe=function(){var e,t,a,n,o,r,s,l,c;"#"===(null===(e=je)||void 0===e?void 0:e.slice(0,1))&&(je=null===(r=je)||void 0===r?void 0:r.slice(1));3===(null===(t=je)||void 0===t?void 0:t.length)&&(je=null===(s=je)||void 0===s||null===(l=s.split(""))||void 0===l||null===(c=l.map((function(e){return e+e})))||void 0===c?void 0:c.join(""));return(299*parseInt(null===(a=je)||void 0===a?void 0:a.substr(0,2),16)+587*parseInt(null===(n=je)||void 0===n?void 0:n.substr(2,2),16)+114*parseInt(null===(o=je)||void 0===o?void 0:o.substr(4,2),16))/1e3>=128?"#000000":"#FFFFFF"},Re=function(e){var t,a;Q(Object(i.a)({},K,Object(c.a)({},null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.name,null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value))),he&&Ee(null)},De=function(e){var t;Q(Object(i.a)({},K,{message:Object(i.a)({},null===K||void 0===K?void 0:K.message,{text:null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value})})),he&&Ee(null)},Le=function(){var e=Object(n.useRef)();return Object(n.useEffect)((function(){return e.current.scrollIntoView({behavior:"smooth"})})),o.a.createElement("div",{ref:e})},Me=function(){var e=Object(v.a)(d.a.mark((function e(){var t,a,n,o,r,s,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(_e,"api/conversations/").concat(Ce.current));case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,!0===(null===a||void 0===a?void 0:a.success)&&(q(null===a||void 0===a?void 0:a.data),Q({email:null===a||void 0===a||null===(n=a.data)||void 0===n||null===(o=n.customer)||void 0===o?void 0:o.email,name:null===a||void 0===a||null===(r=a.data)||void 0===r||null===(s=r.customer)||void 0===s?void 0:s.name}),qe(!0,!0)),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),R(!0),l=p(e.t0),Ee(l);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=Object(v.a)(d.a.mark((function e(t,a){var n,o,r,s,c,i,u,v,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue.setAttribute("data-newmessage","false"),t&&ne(!0),r=null===(n=Ie.current)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.row_id,ze.current){e.next=21;break}return e.prev=4,e.next=7,fetch("".concat(_e,"api/conversations/").concat(Ce.current,"/messages?page[size]=").concat(10).concat(a?"":"&lastMessageAt=".concat(r)));case 7:return s=e.sent,e.next=10,s.json();case 10:c=e.sent,!0===(null===c||void 0===c?void 0:c.success)?(Ie.current=a?Object(l.a)(null===c||void 0===c||null===(i=c.data)||void 0===i?void 0:i.reverse()):[].concat(Object(l.a)(null===c||void 0===c||null===(u=c.data)||void 0===u?void 0:u.reverse()),Object(l.a)(Ie.current||[])),ze.current=(null===c||void 0===c||null===(v=c.data)||void 0===v?void 0:v.length)<10,t&&ne(!1),t&&de(null)):t&&ne(!1),e.next=21;break;case 15:e.prev=15,e.t0=e.catch(4),t&&ne(!1),R(!0),m=p(e.t0),Ee(m);case 21:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t,a){return e.apply(this,arguments)}}(),Je=function(){var e,t;(null===(e=Fe.current)||void 0===e?void 0:e.scrollTop)<=0&&!ze.current&&(null===(t=Ie.current)||void 0===t?void 0:t.length)&&!ae&&!se&&(le(!0),qe().then((function(){le(!1),function(){var e=Fe.current;e&&(e.scrollTop=e.scrollHeight/4)}()})))},He=function(){var e=Object(v.a)(d.a.mark((function e(t){var a,n,o,r,s,l,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!((null===K||void 0===K||null===(a=K.message)||void 0===a||null===(n=a.text)||void 0===n?void 0:n.length)>0)){e.next=19;break}return de(!0),e.prev=3,e.next=6,fetch("".concat(_e,"api/conversations/incoming-messages/widget/").concat(null===Se||void 0===Se?void 0:Se.to),{method:"POST",body:JSON.stringify({email:null===K||void 0===K?void 0:K.email,name:null===K||void 0===K?void 0:K.name,message:null===K||void 0===K?void 0:K.message}),headers:{"Content-type":"application/json; charset=UTF-8"}});case 6:return o=e.sent,e.next=9,o.json();case 9:r=e.sent,!0===(null===r||void 0===r?void 0:r.success)&&(Q(Object(i.a)({},K,{message:""})),Ce.current=null===r||void 0===r||null===(s=r.data)||void 0===s?void 0:s.conversation_id,localStorage.setItem("conversationId",null===r||void 0===r||null===(l=r.data)||void 0===l?void 0:l.conversation_id),q(null===r||void 0===r?void 0:r.data),de(!1),R(!1)),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(3),de(!1),c=p(e.t0),Ee(c);case 19:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}(),Ye=function(){var e=Object(v.a)(d.a.mark((function e(t){var a,n,o,r,s,l,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=null===t||void 0===t?void 0:t.target,n=a.files,!(o=n[0])){e.next=22;break}return $(!0),(r=new FormData).append("media",o),e.prev=7,e.next=10,fetch("".concat(_e,"api/utils/upload"),{method:"POST",body:r});case 10:return s=e.sent,e.next=13,s.json();case 13:!0===(null===(l=e.sent)||void 0===l?void 0:l.success)&&(Q(Object(i.a)({},K,{message:Object(i.a)({},null===K||void 0===K?void 0:K.message,{attachment:{url:null===l||void 0===l?void 0:l.data,type:"IMAGE"}})})),$(!1)),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),c=p(e.t0),Ee(c),$(!1);case 22:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=Object(v.a)(d.a.mark((function e(){var t,a,n,o,r,s,c,u,v,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null===K||void 0===K||null===(t=K.message)||void 0===t||null===(a=t.text)||void 0===a?void 0:a.length)>0)){e.next=23;break}return Ie.current=[].concat(Object(l.a)(Ie.current),[{id:"new",imageUrl:null===K||void 0===K||null===(n=K.message)||void 0===n||null===(o=n.attachment)||void 0===o?void 0:o.url,content:null===K||void 0===K||null===(r=K.message)||void 0===r?void 0:r.text,updatedAt:new Date}]),de(!0),pe(!0),e.prev=4,e.next=7,fetch("".concat(_e,"api/conversations/incoming-messages/widget/").concat(null===Se||void 0===Se?void 0:Se.to),{method:"POST",body:JSON.stringify({email:null===K||void 0===K?void 0:K.email,name:null===K||void 0===K?void 0:K.name,message:null===K||void 0===K?void 0:K.message}),headers:{"Content-type":"application/json; charset=UTF-8"}});case 7:return s=e.sent,e.next=10,s.json();case 10:c=e.sent,!0===(null===c||void 0===c?void 0:c.success)&&(Q(Object(i.a)({},K,{message:{text:""}})),de(!1)),e.next=22;break;case 15:e.prev=15,e.t0=e.catch(4),v=null===(u=Ie.current)||void 0===u?void 0:u.filter((function(e){return"new"!==(null===e||void 0===e?void 0:e.id)})),Ie.current=v,de(null),m=p(e.t0),Ee(m);case 22:pe(!1);case 23:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(){return e.apply(this,arguments)}}();return o.a.createElement(o.a.Fragment,null,w?o.a.createElement(o.a.Fragment,null,x&&o.a.createElement("div",{className:"widget_container ".concat(x?"":"none")},F?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"chat_header",style:{backgroundColor:je,color:Pe()}},o.a.createElement("div",{className:"chevron",onClick:function(){return T(!1)}},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/chevron.svg",alt:""})),o.a.createElement("img",{className:"logo",src:Oe,alt:""}),o.a.createElement("p",null,(null===M||void 0===M?void 0:M.agent)||(null===Se||void 0===Se?void 0:Se.identifier))),he&&o.a.createElement("p",{className:"error_message"},he),o.a.createElement("div",{className:"chat_container"},P?o.a.createElement("form",{className:"chat_signup_form"},o.a.createElement("div",{className:"form_group"},o.a.createElement("input",{name:"name",placeholder:"Your name",onChange:Re,className:"input"})),o.a.createElement("div",{className:"form_group"},o.a.createElement("input",{name:"email",type:"email",placeholder:"Your email",onChange:Re,className:"input"})),o.a.createElement("div",{className:"form_group"},o.a.createElement("textarea",{name:"text",placeholder:"Type message here...",onChange:De,className:"input"})),o.a.createElement("button",{onClick:He,disabled:!(null===K||void 0===K?void 0:K.name)||!(null===K||void 0===K?void 0:K.email)||!(null===K||void 0===K||null===(t=K.message)||void 0===t?void 0:t.text)||ue},"Start Conversation")):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"chat_messages",ref:Fe},se?o.a.createElement("div",{className:"load_previous"},"Loading previous messages..."):!ze.current&&o.a.createElement("div",{className:"load_previous"},"Scroll up to load previous messages"),null===(a=Ie.current)||void 0===a?void 0:a.map((function(e,t){var a,n;return o.a.createElement("div",{key:t,className:"message ".concat(!0===(null===e||void 0===e||null===(a=e.sender)||void 0===a?void 0:a.authUser)?"agent":"")},!0===(null===e||void 0===e||null===(n=e.sender)||void 0===n?void 0:n.authUser)&&o.a.createElement("img",{className:"agent_img",src:Oe,alt:""}),o.a.createElement("div",{className:"content"},(null===e||void 0===e?void 0:e.imageUrl)&&o.a.createElement("img",{src:null===e||void 0===e?void 0:e.imageUrl,alt:""}),o.a.createElement("h6",null,null===e||void 0===e?void 0:e.content),o.a.createElement("p",null,function(e){var t=new Date(e),a=t.getHours(),n=t.getMinutes();n<10&&(n="0"+n);var o=" AM";return a>12&&(a-=12,o=" PM"),a+":"+n+o||""}(null===e||void 0===e?void 0:e.updatedAt))))})),!0===Z&&o.a.createElement("p",{className:"send_status"},"Uploading..."),!0===ue&&o.a.createElement("p",{className:"send_status"},"Sending..."),!1===ue&&o.a.createElement("p",{className:"send_status"},"Sent"),!0===ae&&o.a.createElement("p",{className:"loading"},"Loading..."),ge&&o.a.createElement(Le,null)),o.a.createElement("div",{className:"chat_input_container"},o.a.createElement("textarea",{name:"text",type:"text",className:"input",rows:"2",placeholder:"Type a message here...",value:null===K||void 0===K||null===(r=K.message)||void 0===r?void 0:r.text,onChange:De}),(null===K||void 0===K||null===(s=K.message)||void 0===s?void 0:s.attachment)&&o.a.createElement("div",{className:"file_container"},o.a.createElement("img",{src:null===K||void 0===K||null===(u=K.message)||void 0===u||null===(f=u.attachment)||void 0===f?void 0:f.url,className:"file",alt:""}),o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/close.svg",alt:"",className:"close",onClick:function(){return Q(Object(i.a)({},K,{message:Object(i.a)({},null===K||void 0===K?void 0:K.message,{attachment:null})}))}})),o.a.createElement("div",{className:"input_actions"},o.a.createElement("div",{className:"action",onClick:function(){document.getElementById("selectImage").click()}},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/attachment.svg",alt:""}),o.a.createElement("input",{id:"selectImage",hidden:!0,type:"file",onChange:Ye})),o.a.createElement("div",{className:"action",onClick:Be},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/send.svg",alt:""}))))),o.a.createElement("div",{className:"footer"},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/oneroute.svg",alt:""})," ",o.a.createElement("span",null,"Powered by"," ",o.a.createElement("a",{href:"https://oneroute.io",target:"_blank",rel:"noopener noreferrer"},"OneRoute"))))):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"top_section",style:{backgroundColor:je,color:Pe()}},o.a.createElement("div",{className:"close",onClick:function(){return k(!x)}},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/chevron.svg",alt:""})),o.a.createElement("img",{className:"logo",src:Oe,alt:""}),o.a.createElement("h3",null,Ne),o.a.createElement("h4",null,xe)),o.a.createElement("div",{className:"bottom_section"},o.a.createElement("div",{className:"channels"},null===ye||void 0===ye?void 0:ye.map((function(e,t){var a=e.name,n=e.to;return o.a.createElement(o.a.Fragment,{key:t},"livechat"===(null===a||void 0===a?void 0:a.toLowerCase())?o.a.createElement("div",{className:"item",onClick:function(){return T(!0)}},o.a.createElement("img",{src:Ae(a),alt:""}),o.a.createElement("span",null,a)):o.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"item"},o.a.createElement("img",{src:Ae(a),alt:""}),o.a.createElement("span",null,a)))}))),o.a.createElement("div",{className:"footer"},o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/oneroute.svg",alt:""})," ",o.a.createElement("span",null,"Powered by"," ",o.a.createElement("a",{href:"https://oneroute.io",target:"_blank",rel:"noopener noreferrer"},"OneRoute")))))),!x&&o.a.createElement("div",{className:"trigger_container"},S&&ke&&o.a.createElement("div",{className:"tooltip ".concat(x?"none":"")},ke,o.a.createElement("span",null),o.a.createElement("img",{src:"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/close.svg",alt:"",onClick:function(){return C(!1)}})),o.a.createElement("div",{className:"trigger_btn",style:{backgroundColor:je||"#000"},onClick:function(){return k(!x)}},o.a.createElement("img",{src:Oe||"https://s3.eu-west-3.amazonaws.com/oneroute.asb.ng/oneroute-w.svg",className:x?"":"closed",alt:""})))):o.a.createElement(o.a.Fragment,null))},b=document.querySelector(".oneroute_widget");s.a.render(o.a.createElement(f,b.dataset),b)}},[[45,1,2]]]);
//# sourceMappingURL=main.b6fe40d0.chunk.js.map